jQuery(function(e){var t={accordion_index:0,ready:function(){var o=e(".metabox_groupbox_fields_sortables");o.sortable({connectWith:".metabox-field-postbox-item",handle:".metabox-handle-title",placeholder:"metabox-placeholder ui-corner-all"});var a=e(".metabox-accordion-sortables");a.sortable({connectWith:".metabox-field-postbox-item",handle:".metabox-handle-title",placeholder:"metabox-placeholder ui-corner-all"});try{this.accordion_index=accordion_index}catch(e){}a.on("sortupdate",this.on_accordion_sortupdate),a.each(function(o,a){var i=e(a).find(".accordion-template-item").find(".metabox-accordion-title").find(".title").attr("data-accordion-title-field");e(document).on("keyup",'input[type=text][id*="'+i+'"]',t.on_accordion_field_title_keyup)}),e(document).on("click",".metabox-collapse-button",this.on_collapse_field_box).on("click",".metabox-accordion-remove-button",this.on_accordion_remove_field).on("click",".metabox-handle-title, .metabox-collapse-button",this.on_accordion_handle_click),e(".metabox-accordion-add-button").click(this.on_accordion_add_field),$firstMetabox=e("#advanced-sortables .postbox:eq(0)").find(".metabox_groupbox_fields_sortables:eq(0)").find(".metabox-field-postbox-item:eq(0)"),$firstMetabox.find("h2:eq(0)").click(),$firstMetabox.removeClass("closed")},on_accordion_sortupdate:function(t,o){var a=0,i="",n="",c=null;e(".metabox-accordion-item:not(.accordion-template-item)").each(function(){c=e(this).find("*[name]"),c.each(function(){i=e(this).attr("id"),n=e(this).attr("name");var t=n.split(/\[\d\]/),o="",c="";2===t.length&&(o=t[0],c=t[1],c=c.replace("[","\\["),c=c.replace("]","\\]"),n=n.replace(new RegExp(o+"\\[\\d\\]"+c,"ig"),o+"["+a+"]"+c),n=n.replace(/\\/gi,""),e(this).attr("name",n),t=i.split(/-\d-/),o=t[0],c=t[1],i=i.replace(new RegExp(o+"-\\d-"+c,"ig"),o+"-"+a+"-"+c),e(this).attr("id",i))}),a++})},on_collapse_field_box:function(t){var o=e(this).closest(".metabox-field-postbox-item");o.siblings().filter(function(t){return!e(this).hasClass("closed")}).addClass("closed"),o.toggleClass("closed")},on_accordion_add_field:function(o){var a=e(this).next(".metabox-accordion-group"),i=a.find(".accordion-template-item").clone();i.removeClass("accordion-template-item"),e(this).next(".metabox-accordion-sortables").sortable("refresh"),i.find('*[id*="-uo-"], *[name*="-uo-"]').each(function(o,a){var i=e(a),n=i.attr("id"),c=i.attr("name");void 0!==n&&(i.is("textarea")&&i.hasClass("wp-editor-area")&&i.data("editor-old-id",n),n=n.replace(new RegExp("-uo-","ig"),""),n=n.replace(new RegExp("-uc-","ig"),""),n=n.replace(new RegExp("__index__","ig"),t.accordion_index),i.attr("id",n)),void 0!==c&&(c=c.replace(new RegExp("-uo-","ig"),"["),c=c.replace(new RegExp("-__index__-","ig"),t.accordion_index),c=c.replace(new RegExp("-uc-","ig"),"]"),e(a).attr("name",c))}),i.removeClass("closed").appendTo(a);var n=i.find(".wp-editor-wrap").find("textarea");n.each(function(t,o){var a=e(o),i=a.closest(".wp-editor-container"),n=i.prev(".wp-editor-tools"),c=n.find("button.add_media"),d=n.find("button.wp-switch-editor"),r=a.attr("id"),l=a.data("editor-old-id"),s=a.attr("name");a.prev(".mce-container").remove(),a.prev(".quicktags-toolbar").remove(),a.remove(),c.attr("data-editor",r),d.attr("data-wp-editor-id",r),i.append("<textarea class='wp-editor-area' rows='5' tabindex='1' autocomplete='off' cols='40' id='"+r+"' name='"+s+"'></textarea>");var m=tinyMCEPreInit.mceInit[l];m.selector="#"+r,tinymce.init(m);var p=quicktags({id:r}),x=setInterval(function(){"object"==typeof p&&(QTags._buttonsInit(),n.find(".wp-switch-editor.switch-html").click(),clearInterval(x))},200)}),t.accordion_index++},on_accordion_remove_field:function(o){var a=e(this).closest(".metabox-accordion-item");a.find("textarea[class='wp-editor-area']").each(function(t,o){tinymce.get(e(o).attr("id")).remove()}),a.remove(),t.accordion_index--},on_accordion_field_title_keyup:function(t){var o=e(this).closest(".metabox-accordion-item"),a=o.find(".metabox-accordion-title").find(".title"),i=e(this).val();""!==i?a.html(" : "+i):a.html("")},on_accordion_handle_click:function(t){var o=e(this);o.hasClass("metabox-collapse-button")&&(o=e(this).next("h2.metabox-handle-title"));var a=o.closest(".metabox-field-postbox-item");if(a.closest(".metabox-field-postbox-item").siblings().find("h2.metabox-handle-title").removeClass("markup"),o.hasClass("markup")||o.addClass("markup"),a.hasClass("closed")){var i=a.find(".metabox-field-postbox-item");i.length>0&&(i.find("h2.metabox-handle-title").removeClass("markup"),i.addClass("closed"))}}};t.ready()});